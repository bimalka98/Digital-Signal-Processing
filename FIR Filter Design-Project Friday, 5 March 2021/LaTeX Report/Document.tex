%  -----------------------------------------------------------------------------
%  Author         : Bimalka Piyaruwan Thalagala
%  GitHub         : https://github.com/bimalka98
%  Date Created   : 01.09.2020
%  Last Modified  : 15.02.2020
%  -----------------------------------------------------------------------------

\documentclass[a4paper,11pt]{article}%,twocolumn
\input{settings/packages}
\input{settings/page}
\input{settings/macros}
\usepackage[ framed, numbered]{matlab-prettifier}%framed,%
\usepackage{listings}
\usepackage{physics}
\usepackage{pdfpages}
\begin{document}
\input{content/title_page}

\begin{abstract}
	Design procedure of a Finite Duration Impulse Response(FIR) bandpass Digital Filter which satisfies a set of prescribed specifications, is described in this report where windowing method in conjunction with the Kaiser window is used for the designing procedure. Operation of the filter was analyzed with a combination of sine functions. The design was implemented and tested using {\tt MATLAB R2018a} of the MathWorks Inc. Therefore implementation is not guaranteed to work on the previous version of the software.
\end{abstract}

\pagebreak
\tableofcontents
\listoffigures
\listoftables
\begin{center}
	\textbf{\textit{* PDF is clickable}}
\end{center}



\textit{Note:}\\
\textit{Additionally all the materials related to Task can also be found at \url{}}
\pagebreak

\section{Introduction}

This report describes the design procedure of an FIR bandpass digital filter.

\section{Method}

\subsection{Filter Implementation}
Filter implementation consists of the steps mentioned below. Subsections of this section of the report describes each one of them for designing an FIR bandpass filter.

\begin{enumerate}[\hspace{1cm}1.]
	\item Identifying the prescribed filter specifications
	\item Derivation of the filter Parameters
	\item Derivation of the Kaiser Window Parameters
	\item Derivation of The Ideal Impulse Response
	\item Truncating the Ideal Impulse Response to obtain Finite Impulse Response: Windowing
\end{enumerate}
\pagebreak
\subsubsection{Prescribed Filter specifications}
Following table describes the desired specifications of the bandpass filter which need to be implemented. The notation used here is the same as the notation used in the reference material\cite{antonio} and they will be used throughout the report.

\begin{table}[!h]
	\centering
	\caption{Prescribed Filter specifications}
	\begin{tabular}{l c r}
		\hline
		\textbf{Parameter}& \textbf{Symbol}&\textbf{Value}\\\hline
		&&\\
Maximum passband ripple(\textit{desired})&$\tilde{A_p}$&0.09 dB\\
Minimum stopband attenuation(\textit{desired})&$\tilde{A_a}$&48 dB\\
Lower passband edge&$\omega_{p1}$&400 rad/s\\
Upper passband edge&$\omega_{p2}$&800 rad/s\\
Lower stopband edge&$\omega_{a1}$&250 rad/s\\
Upper stopband edge&$\omega_{a2}$&900 rad/s\\
Sampling frequency&$\omega_s$&2600 rad/s\\
\hline\hline
	\end{tabular}

\end{table}

Following figure illustrates the aforementioned specifications for an idealized frequency responses of Bandpass filter. $\delta$ in the figure has the following relationship with peak to peak passband ripple(\textit{practical}) $A_p$ and the minimum stopband attenuation(\textit{practical}) $A_a$.\\

\begin{equation}
	\tilde{A_p} \ge A_p = 20\log(\frac{1+\delta}{1-\delta})
	\label{A_p}
\end{equation}
\begin{equation}
 \tilde{A_a} \le A_a = -20\log(\delta)
 \label{A_a}
\end{equation}

\begin{figure}[!h]
	\centering
	\includegraphics[scale=0.4]{figures/filtersepecs}
	\caption{Idealized frequency response of a Bandpass filter\cite{antonio}}
\end{figure}
\pagebreak
\subsubsection{Derivation of filter Parameters}

According to the given specifications following parameters are calculated.

\begin{table}[!h]
	\centering
	\caption{Derivation of filter Parameters}
\begin{tabular}{l c c r}
	\hline
\textbf{Parameter}& \textbf{Symbol}& \textbf{Calculation}&\textbf{Value}\\\hline
&&&\\
Lower transition width& $B_{t1}$& $\omega_{p1} - \omega_{a1}$&150 rad/s\\
Upper transition width& $B_{t2}$&$\omega_{a2}-\omega_{p2}$&100 rad/s\\
Critical transition width& $B_t$&$\min(B_{t1},B_{t2})$&100 rad/s\\
Lower cutoff frequency& $\omega_{c1}$&$\omega_{p1}-B_t/2$&350 rad/s\\
Upper cutoff frequency& $\omega_{c2}$&$\omega_{p2}+B_t/2 $&850 rad/s \\
Sampling period& $T$& $2\pi / \omega_s$&$0.0024$ s\\
\hline\hline
\end{tabular}

\end{table}

\subsubsection{Derivation of the Kaiser Window Parameters}

Following equation represents the Kaiser window which will be used to truncate the Infinite duration Impulse Response to obtain the Finite duration Impulse Response for our filter design.

\begin{equation}
w_K(nT) = \begin{cases}
	\frac{I_0(\beta)}{I_0(\alpha)} & for \abs{n}  \leq \frac{N-1}{2} \\
	0 & Otherwise
	\label{kaiser}
\end{cases}
\end{equation}


where $\alpha$ is an independent parameter and $I_0(x)$ is the zeroth-order modified Bessel function of the first kind.\\
%372
\[
\beta = \alpha\sqrt{1-\left(\frac{2n}{N-1}\right)^2} \hspace*{1cm} I_0(x) = 1+\sum_{k=1}^{\infty}\left[\frac{1}{k!}\left(\frac{x}{2}\right)^k\right]^2
 \]

Now we have to calculate the required parameters as follows,

\begin{enumerate}[\hspace{1cm}a.)]
\item Choose $\delta$ in Eqs. \eqref{A_p} and \eqref{A_a} such that $\delta = \min(\tilde{\delta_p}, \tilde{\delta_a})$ where,

\[
\begin{split}
	\tilde{\delta_p} &= \frac{10^{0.05\tilde{A_p}}-1}{10^{0.05\tilde{A_p}}+1}\\
	&=\frac{10^{0.05*0.09}-1}{10^{0.05*0.09}+1}\\
	&=5.181\times10^{-3}
\end{split}
\hspace{2cm}
\begin{split}
	\tilde{\delta_a} &= 10^{-0.05\tilde{A_a}}\\
&=3.981\times10^{-3}
\end{split}
\]
\begin{center}
	$\therefore~ \delta = 3.981\times10^{-3} $
\end{center}

\item With the required $\delta$ defined, the actual stopband loss(attenuation) $A_a$ in dB can be calculated using Eq. \ref{A_a}.
\[
\begin{split}
	 \tilde{A_a} \le A_a &= -20\log(\delta)\\
	 &=-20\log(3.981\times10^{-3})\\
	A_a &= 48 ~dB
\end{split}
\]

\item Choose parameter $\alpha$ as,
    \[
\alpha = \begin{cases}
	0 & for~  A_a \leq 21 ~dB \\
	0.5842(A_a - 21)^{0.4} + 0.07886(A_a - 21) & for ~ 21 < A_a \leq 50 ~dB \\
	0.1102(A_a - 8.7) & for~  A_a > 50 ~dB
\end{cases}
\]

\[
\begin{split}
\therefore~ \alpha &= 0.5842(A_a - 21)^{0.4} + 0.07886(A_a - 21)\\
&=	0.5842(48 - 21)^{0.4} + 0.07886(48 - 21)\\
&=4.3125
\end{split}
\]

\item Choose parameter D as,

\[
D = \begin{cases}
	0.9222 & for ~ A_a \leq 21 ~dB \\

	\frac{A_a - 7.95}{14.36} & for ~ A_a > 21 ~dB
\end{cases}
\]\hspace{2cm}
\[
\begin{split}
	\therefore~ D &= \frac{A_a - 7.95}{14.36}\\
	&=\frac{48 - 7.95}{14.36}\\
	&=  2.7890
\end{split}
\]

\item Then select the lowest odd value of N that would satisfy the inequality,
\[
\begin{split}
	N  & \geq \frac{\omega_sD}{B_t}+1\\
	&\geq \frac{2600*2.79}{100}+1\\
	&\geq 73.51
\end{split}
\hspace{2cm}
\therefore~	N = 75
\]
\end{enumerate}
\subsubsection{Derivation of The Ideal Impulse Response}

\textbf{\textit{Note : Here subscript `d' implies ``desired'', as it is the ideal response of the filter. Subscript d will be omitted to indicate a given expression is no longer ideal.\\}}

The frequency response of an ideal bandpass filter with cutoff frequencies $\omega_{c1}$ and $\omega_{c2}$ is given by,

\[
H_d(e^{j\omega T}) = \begin{cases}
1& for~ -\omega_{c2} \le \omega \le -\omega_{c1}\\
1& for ~\omega_{c1} \le \omega \le \omega_{c2}\\
0& Otherwise
\end{cases}
\]

Using the Inverse Fourier Transform, impulse response of the above $H(e^{j\omega T})$ is calculated.
\[
\begin{split}
	h_d(nT) &=\frac{1}{\omega_s}\int_{-\omega_s/2}^{\omega_s/2} H(e^{j\omega T})e^{j\omega nT}~d\omega\\
	&=\frac{1}{\omega_s}\left[\int_{-\omega_{c2}}^{-\omega_{c1}} e^{j\omega nT} ~d\omega+ \int_{\omega_{c1}}^{\omega_{c2}} e^{j\omega nT}~ d\omega\right]\\
	&=\frac{1}{\omega_s} \left[ \left.\frac{e^{j\omega nT}}{jn T}\right|_{-\omega_{c2}}^{-\omega_{c1}} + \left.\frac{e^{j\omega nT}}{jn T}\right|_{\omega_{c1}}^{\omega_{c2}} \right]\\
	&= \frac{1}{j\omega_s nT} \left[  e^{-j\omega_{c1}nT} - e^{-j\omega_{c2}nT}  +  e^{j\omega_{c2}nT} - e^{j\omega_{c1}nT}  \right] ; where~\omega_sT = 2\pi\\
	&= \frac{1}{\pi n}\left[ \frac{(e^{j\omega_{c2}nT} - e^{-j\omega_{c2}nT})}{2j} - \frac{(e^{j\omega_{c1}nT} - e^{-j\omega_{c1}nT})}{2j}  \right] ; rearanging\\
	&=	\frac{1}{\pi n}\left[   \sin(\omega_{c2}nT) - \sin(\omega_{c1}nT)  \right]; from~ Euler's ~Eq.
\end{split}
\]

\begin{equation}
	\therefore ~ h_d(nT) = \begin{cases}
		\frac{1}{\pi n}\left[   \sin(\omega_{c2}nT) - \sin(\omega_{c1}nT)  \right] & \forall n \ne 0\\
		&\\
		\frac{2}{\omega_s}\left( \omega_{c2} - \omega_{c1}\right)& for~ n = 0
	\end{cases}
\label{idealresponse}
\end{equation}


\subsubsection{Truncating the Ideal Impulse Response to obtain Finite Impulse Response: Windowing}

By multiplying the ideal impulse response $h_d(nT)$ in Eq. \eqref{idealresponse} with the Kaiser window $w_K(nT)$ in Eq. \eqref{kaiser}, the ideal infinite impulse response can be truncated to obtain the finite impulse response $h(nT)$ for practical implementation.
\begin{equation}
h(nT) = 	w_K(nT).h_d(nT)
\end{equation}

Obtaining the transfer function in the $\mathcal{Z}$ domain using $\mathcal{Z}$ Transformation,
\begin{equation}
	\begin{split}
			H'(z) &= \mathcal{Z}\left\{ h(nT) \right\}\\
		&=\mathcal{Z}\left\{ w_K(nT).h_d(nT) \right\}
	\end{split}
\end{equation}

The response is anti-causal it need to be shifted in the time domain to make it causal and get the final filter response$H(Z)$, in $\mathcal{Z}$ domain it is represented as follows.
\begin{equation}
	H(z)= z^{-\left(\frac{N-1}{2}\right)}.H'(z)
\end{equation}

\subsection{Filter Performance Evaluation}

Performance of the filter was evaluated by using the following excitation $x(nT)$ which is a combination of three sinusoidal signals. Frequencies of these three sinusoidal signals are specified as follows to cover all three bands in the filter.

\[x(nT) = \sum_{i=1}^{3}sin(w_inT)\]

\begin{table}[!h]
	\centering
	\begin{tabular}{l c c r}
		\hline
	\textbf{Parameter}& \textbf{Symbol}& \textbf{Calculation}&\textbf{Value}\\\hline
	&&&\\
	Middle frequency of the lower stopband& $\omega_1$&$\frac{0+ \omega_{a1}}{2}$&125 rad/s\\
	Middle frequency of the passband &$\omega_2$&$\frac{\omega_{p1}+\omega_{p2}}{2}$&600 rad/s\\
	Middle frequency of the upper stopband& $\omega_3$&$\frac{\omega_{a2}+\omega_s/2}{2}$&11 rad/s\\
	\end{tabular}
\end{table}


\section{Results}
\section{Discussion}
\section{Conclusion}
%\lstinputlisting[basicstyle = \mlttfamily\scriptsize , style = Matlab-editor]{code/RFPL.m}


\pagebreak
\bibliographystyle{plain}
\bibliography{refer}
\includepdf[]{code/bandpass180631J.pdf}
%---------------------------------------------------------------------------
\end{document}
-
